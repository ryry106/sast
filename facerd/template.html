<html>

<head>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages': ['corechart']})
//    google.charts.setOnLoadCallback(drawChart);

    getResource = async() => {
      return await (await fetch("http://localhost:8080/resource")).text()
    }

    filter = async () => {
      res = JSON.parse(await getResource())
      return {
        name: res.name,
        sp_max: Math.max(res.List.map(elm => elm.SP)),
        sp_list: [
          ['day', 'param'],
        ].concat(res.List.map(elm => ["", elm.SP]))
      }
    }

    drawChart = async () => {
      source = await filter(await getResource())

      var data = google.visualization.arrayToDataTable(source.sp_list);

      var options = {
        title: source.name,
        legend: {position: 'bottom'},
        vAxis: {maxValue: source.sp_max, minValue: 0},
      };

      var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

      chart.draw(data, options);
    }

    // callbackでasyncメソッドを叩くようにしたいところ
    drawChart()
  </script>
</head>

<body>
  <div id="curve_chart" style="width: 900px; height: 500px"></div>
</body>

</html>
