<html>

<head>
  <style>
    .table {
      display: table;
    }

    .charts {
      border: 1px solid;
    }
  </style>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages': ['corechart']})

    drawChart = () => {
      fetch("http://localhost:8080/resource")
        .then(res => {
          if (res.ok) {
            return res.text()
          } else {
            return Promise.reject(new Error('/resource Error.'));
          }
        })
        .then(body => {
          source = filter(body)
          addChart(source)
        })
    }

    addChart = (source) => {
      var data = google.visualization.arrayToDataTable(source.sp_list);
      var options = {
        title: source.name,
        legend: {position: 'bottom'},
        vAxis: {maxValue: source.sp_max, minValue: 0},
      };

      const elm = document.createElement("div")
      elm.id = 'curve_chart_' + document.querySelectorAll("div[id^='curve_chart']").length
      elm.classList.add("charts")
      document.querySelector(".table").insertAdjacentElement('afterbegin', elm)
      new google.visualization.LineChart(elm).draw(data, options)
    }

    filter = (body) => {
      res = JSON.parse(body)
      return {
        name: res.name,
        sp_max: Math.max(res.list.map(elm => elm.sp)),
        sp_list: [
          ['day', 'param'],
        ].concat(res.list.map(elm => ["", elm.sp]))
      }
    }

    google.charts.setOnLoadCallback(drawChart);
  </script>
</head>
<div class="table"></div>

<body>
</body>

</html>
